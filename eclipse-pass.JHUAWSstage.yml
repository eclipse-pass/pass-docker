# Manages the stage.eclipse-pass.org deploy
# `docker-compose -f docker-compose.yml -f eclipse-pass.JHUAWSstage.yml up`
# Note the env_file and secrets files do not exist in this repo. They will be in
# JHU AWS Stage environment.
version: '3.8'

services:
  auth:
    env_file:
      - .eclipse-pass.JHUAWSstage_env
    secrets:
      - source: sp_key
      - source: sp_cert
      - source: idp_cert

  proxy:
    env_file:
      - .eclipse-pass.JHUAWSstage_env

  pass-core:
    env_file:
      - .eclipse-pass.JHUAWSstage_env
    ports:
      - "8080:8080"

  pass-ui:
    env_file:
      - .eclipse-pass.JHUAWSstage_env

secrets:
  idp_cert:
    file: ./stage-idp-signing.crt
  sp_key:
    file: ./stage-sp-key.pem
  sp_cert:
    file: ./stage-sp-cert.pem
